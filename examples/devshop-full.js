/**
 * Copyright (c) 2011 Roger Myrg http://devshop.me/
 * Released under the MIT license:
 * https://github.com/rgr-myrg/DevShop-JS/raw/master/MIT-LICENSE
 */
(function(d){d.DevShop=typeof d.DevShop==="object"?d.DevShop:{}})(window);(function(d){d.SingletonFactory=function(c){var b=function(a){if(typeof a==="function")try{return new a}catch(e){}else if(typeof a==="object")return a},f=b(c.__implement),a=b(c.__extend),b=b(c.__construct),e;for(e in a)a.hasOwnProperty(e)&&(b[e]||(b[e]=a[e]));for(e in f)if(f.hasOwnProperty(e)&&!b[e])throw c.instance+" must implement '"+e+"' "+typeof f[e];if(typeof b.initialize==="function")try{b.initialize()}catch(d){}return b}})(DevShop);(function(d){d.Observable=function(c){return DevShop.SingletonFactory({__extend:function(){return{observers:[],addObserver:function(b){if((typeof b==="function"||typeof b==="object")&&typeof b.notify==="function")if(this.observers.push(b),typeof b.onRegister==="function")b.onRegister()},notifyObservers:function(b){for(var c=this.observers.length,a=0;a<c;a++)this.observers[a].notify(b,this)}}},__construct:c})}})(DevShop);(function(d){d.Observer=function(c){return DevShop.SingletonFactory({__extend:function(){return{onRegister:function(){},notify:function(b,c){this.observable=c;if(typeof this[b]==="function")try{this[b]()}catch(a){}}}},__construct:c})}})(DevShop);(function(d){d.EventSignal=function(){var c=[];return{addListener:function(b){typeof b==="function"&&c.push(b)},removeListener:function(b){for(var d=c.length,a=0;a<d;a++)c[a]===b&&(c[a]=null)},dispatch:function(){for(var b=c.length,d=0;d<b;d++)typeof c[d]==="function"&&c[d].apply(this,arguments)}}}})(DevShop);(function(d){d.IProxy={NAME:""};d.IMediator={NAME:"",listNotificationInterests:function(){},handleNotification:function(){}};d.ICommand={execute:function(){}};d.Proxy=function(){var c={};return{facade:null,setData:function(b){c=b},getData:function(){return c},onRegister:function(){},onRemove:function(){}}};d.Mediator=d.Observer(function(){return{facade:null,onRegister:function(){},onRemove:function(){}}});d.Facade=function(){var c=new function(){var a={};return{facade:{},registerProxy:function(e){e.facade=
this.facade;a[e.NAME]||(a[e.NAME]=e);if(typeof e.onRegister==="function")e.onRegister()},retrieveProxy:function(e){return a[e]?a[e]:null},removeProxy:function(e){if(typeof a[e].onRemove==="function")a[e].onRemove();a[e]=null}}},b=new d.Observable(function(){var a={};return{facade:{},notification:{},registerMediator:function(e){e.facade=this.facade;a[e.NAME]||(a[e.NAME]=e,this.addObserver(e))},retrieveMediator:function(e){return a[e]?a[e]:null},removeMediator:function(e){if(typeof a[e].onRemove===
"function")a[e].onRemove();a[e]=null},notifyObservers:function(a){for(var b=this.observers.length,c=0;c<b;c++){for(var d=this.observers[c].listNotificationInterests(),f=!1,g=0;l=d.length,g<l;g++)if(d[g]==this.notification.name){f=!0;break}if(f)this.observers[c].notification=this.notification,this.observers[c].notify(a,this)}},sendNotification:function(a){this.notification=a;this.notifyObservers("handleNotification")}}}),f=new d.Observer(function(){var a={},b=[];return{facade:{},NAME:"BTG.Controller",
registerCommand:function(c,d){d.facade=this.facade;a[c]||(a[c]=d,b.push(c))},listNotificationInterests:function(){return b},handleNotification:function(){var b=this.notification;typeof a[b.name]==="object"&&typeof a[b.name].execute==="function"&&a[b.name].execute(b)}}});return{CMD_STARTUP:"CMD_STARTUP",registerProxy:function(a){c.registerProxy(a)},registerMediator:function(a){b.registerMediator(a)},registerCommand:function(a,b){f.registerCommand(a,b)},retrieveProxy:function(a){return c.retrieveProxy(a)},
retrieveMediator:function(a){return b.retrieveMediator(a)},removeProxy:function(a){c.removeProxy(a)},removeMediator:function(a){b.removeMediator(a)},sendNotification:function(a,c,d){b.sendNotification({name:a,body:c,type:d})},initializeFacade:function(){c.facade=this;b.facade=this;f.facade=this;this.registerMediator(f)}}}})(DevShop);(function(d){d.Publisher=function(){var c={};return{registerEvents:function(b){typeof b==="object"&&(c=b)},registerSubscriber:function(b){if(typeof b.onRegister==="function"){var d=b.onRegister(),a;for(a in d)d.hasOwnProperty(a)&&typeof c[a]==="object"&&c[a].addListener(d[a]);b.onRegister=function(){}}},notify:function(b,c){typeof b.dispatch==="function"&&b.dispatch(c)}}}})(DevShop);
